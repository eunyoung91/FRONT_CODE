<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<title>에듀윌 그룹웨어(Genius)</title>

<!-- favicon files -->
<link rel="Bookmark Icon" href="//img.eduwill.net/Img2/Common/favicon/favicon.ico" />
<link rel="icon" href="//img.eduwill.net/Img2/Common/favicon/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="//img.eduwill.net/Img2/Common/favicon/favicon.ico" type="image/x-icon" />

<!-- css files -->
<!-- layout css -->
<link rel="stylesheet" href="https://img.eduwill.net/resources/kpi/dev/plugins/bootstrap/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://img.eduwill.net/resources/kpi/dev/css/essentials.css" />
<link rel="stylesheet" href="css/genius.css" />


<!-- javascript files -->
<script type="text/javascript">var plugin_path = '//img.eduwill.net/resources/kpi/live/plugins/';</script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/jquery/jquery-2.2.3.min.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/jquery/jquery-ui-1.12.1.min.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/js/jquery.easyui.min.js" type="text/javascript" ></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/bootstrap.datepicker/js/bootstrap-datepicker.min.js"></script>
<script src="//img.eduwill.net/resources/kpi/live/js/ajaxUtil.js" type="text/javascript"></script>

<!-- validation -->
<script src="//img.eduwill.net/resources/kpi/live/plugins/form.validate/jquery.form.min.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/form.validate/jquery.validation.min.js" type="text/javascript"></script>

<script src="//img.eduwill.net/resources/kpi/live/js/custom.js?v=5a2d148c09b00" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/js/common.js?v=5ad59eb6c6f40" type="text/javascript"></script>

<!-- 토스트메시지 -->
<link href="//img.eduwill.net/resources/kpi/live/plugins/toastr/toastr.min.css" rel="stylesheet" type="text/css" />
<script src="//img.eduwill.net/resources/kpi/live/plugins/toastr/toastr.min.js" type="text/javascript"></script>

<!-- 컨펌모달 -->
<link rel="stylesheet" href="//img.eduwill.net/resources/kpi/live/plugins/jquery-confirm/jquery-confirm.min.css">
<script src="//img.eduwill.net/resources/kpi/live/plugins/jquery-confirm/jquery-confirm.min.js"></script>

<!-- print -->
<script type="text/javascript" src="//img.eduwill.net/resources/kpi/live/plugins/printThis/printThis.js"></script>

<!-- editable -->
<script type="text/javascript" src="//img.eduwill.net/resources/kpi/live/plugins/bootstrap-editable.min.js"></script>

<!-- Fullcalendar -->
<link rel="stylesheet" href="//img.eduwill.net/resources/kpi/live/plugins/fullcalendar/fullcalendar.min.css" />
<link rel="stylesheet" href="//img.eduwill.net/resources/kpi/live/plugins/fullcalendar/fullcalendar.print.css" media="print" />
<script src="//img.eduwill.net/resources/kpi/live/plugins/moment.min.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/fullcalendar/fullcalendar.min.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/fullcalendar/lang-all.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/fullcalendar/gcal.js" type="text/javascript"></script>

<!-- CKEditor -->
<script src="//img.eduwill.net/resources/kpi/live/plugins/ckeditor/ckeditor_4.10.0_full/ckeditor.js"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/ckeditor/ckeditor_4.10.0_full/adapters/jquery.js"></script>

<script type="text/javascript">
	function pagePrint(){
		$('#pagePrint').printThis();
	}

	$(document).ready(function() {
		/** Bootstrap Tooltip **/ 
		$("[data-toggle=tooltip]").tooltip();
	})

</script>

</head>

<body class="body-sub body-genius">

<!-- wrapper -->
<div id="wrapper" class="clearfix">

	<!-- hd-wrap -->
    <section class="hd-wrap">
        <div class="hd-wrap-inner">
            <div class="logo">
                <a href="">지니어스</a>
            </div>
            <div class="gnb">
                <ul>
                    <li><a href="">전자결재</a></li>
                    <li><a href="">전사공지</a></li>
                    <li><a href="">업무요청</a></li>
                    <li><a href="">인사관리</a></li>
                    <li><a href="">지원관리</a></li>
                </ul>
            </div>
            <div class="comp-right">
                
                <div class="logout">
                    <button class="btn btn-g-link">로그아웃</button>
                </div>
                <div class="state">
                    <span onclick="$(this).next('.menu-tootip').fadeIn(100);"><i class="state-1"></i> 근무중</span>
                    <!--
                    <span><i class="state-2"></i> 자리비움</span>
                    <span><i class="state-3"></i> 로그오프</span>
                    -->
                    <div class="menu-tootip" style="display: none;" onclick="$(this).fadeOut(100);">
                        <div class="menu-tootip-inner">
                            <div class="link"><a href="#"><i class="state-1"></i> 근무중</a></div>
                            <div class="link"><a href="#"><i class="state-2"></i> 자리비움</a></div>
                            <div class="link"><a href="#"><i class="state-3"></i> 로그오프</a></div>
                        </div>
                    </div>
                </div> 
                <div class="organization">
                    <span><button class="btn btn-g-link btn-setting">관리자</button></span>
                    <span><button class="btn btn-g-link btn-person">조직도</button></span>
                </div>               
            </div>
        </div>
    </section>
    <div class="hd-wrap-expand" style="display: none;">
        <div class="hd-wrap-expand-inner">
            <div class="link">
                <a herf="">결재문서 작성</a>
                <a herf="">결재하기</a>
                <a herf="">수신함</a>
                <a herf="">매출/예산 계획 제출</a>
            </div>
            <div class="link">
                <a herf="">공지사항</a>
                <a herf="">에듀윌러 소식</a>
                <a herf="">에듀윌 스타</a>
                <a herf="">꿈의 직장</a>
            </div>
            <div class="link">
                <a herf="">마케팅</a>
                <a herf="">총무</a>
                <a herf="">IT</a>
                <a herf="">법무</a>
            </div>
            <div class="link">
                <a herf="">인사정보</a>
                <a herf="">평가</a>
                <a herf="">교육</a>
                <a herf="">자주 묻는 질문</a>
            </div>
            <div class="link">
                <a herf="">힐링큐브</a>
                <a herf="">E-스퀘어</a>
                <a herf="">차량배차</a>
                <a herf="">마음,쉼</a>
            </div>
        </div>
    </div>
    <!-- // hd-wrap -->

	<!-- aside -->
	<aside id="aside">
		<div class="aside-loaction">
			<strong>전사공지</strong>
			<button class="btn-collapse">접기</button>
		</div>
		<nav id="sideNav">
			<ul class="nav nav-list d1">
				<li class="d1 el_primary menu-open active">
					<a href="javascript:;" class="d1">
						<i class="main-icon fa fa-gears"></i>
						<span>공지사항</span>
					</a>
					<ul class="d2"><!-- 2depth -->
						<li class="d2 active">
							<span>업적/역량</span>
							<ul class="d3"><!-- 3depth -->
								<li class="d3 active">
									<a href="javascript:;" class="d3">전체공지
										<!-- <span class="label label-number">8</span> -->
									</a>
								</li>
								<li class="d3">
									<a href="javascript:;" class="d3">평가목표 관리</a>
								</li>
							</ul><!-- // 3depth -->
						</li>
					</ul><!-- // 2depth -->
				</li>
				<li class="d1 el_primary">
					<a href="javascript:;" class="d1">
						<i class="main-icon fa fa-balance-scale"></i>
						<span>에듀윌러 소식</span>
					</a>
					<ul class="d2"><!-- 2depth -->
						<li class="d2">
							<a href="javascript:;" class="d2">depth2</a>
						</li>
						<li class="d2">
							<a href="javascript:;" class="d2">depth2</a>
						</li>
					</ul>
				</li>
				<li class="d1 el_primary">
					<a href="javascript:;" class="d1">
						<i class="main-icon fa fa-pencil-square-o"></i>
						<span>에듀윌 스타</span>
					</a>
					<ul class="d2"><!-- 2depth -->
						<li class="d2">
							<a href="javascript:;" class="d2">depth2</a>
						</li>
						<li class="d2">
							<a href="javascript:;" class="d2">depth2</a>
						</li>
					</ul>
				</li>
				<li class="d1">
					<a href="javascript:;" class="d1">
						<i class="main-icon fa fa-table"></i>
						<span>꿈의직장</span></span>
					</a>
				</li>
			</ul>
		</nav>
	</aside>
	<div id="expand-wrap" style="display: none;">
		<button class="btn-expand">열기</button>
	</div>
	<!-- // aside -->

	<!-- middle -->		
	</section>
	<section id="middle">
		<script type="text/javascript">
			var ajaxUtil = new AjaxUtil();
			var callUrl = "";
			var param = "";
		
			$(document).ready(function() {
				init();
				
				//오늘날짜 셋팅
				$("#attendDay").val($.datepicker.formatDate('yy-mm-dd', new Date()));
				
				//차수
				callUrl = "/common/ajaxCommonCodeList";
				param = {"mstcd" : "MC077"};
				ajaxUtil.commonAjaxPost(callUrl, param, "#rnd", "", "차수 선택", false);
				
				//override validate 
				$("#frm1").validate({	
					errorPlacement: function(error, element) {
						var msg = $(element).data("msg");
						fnc_toastMsgForWarning(msg);
					},
					highlight: function(element, errorClass, validClass) {
						$(element).addClass('error').removeClass(validClass);
					}
				});
				
				// 세션유지를 위한 ajax통신
				var timer = setInterval(function(){
					$.ajax({
						type:"post"
						,url:"/eins/ajaxHealthChk"
						,data: {}
						,dataType:"json"
						,success: function(data) {}
						,error: function(responseJSON, status, err) {}
						,complete: function() {}
					});
				}, 1000 * 60 * 5); //5분
				
				
				//autocomplete용  list click event
				$("body").off("click", "#ulAutoEmp li");
				$("body").on("click", "#ulAutoEmp li", function() {
					var item = this;
					fnc_autoSelectEmployee(_target, item);
				});
				
				//autocomplete용 이벤트 중복 방지를 위해 off 선행
				$("#schVal").off("keyup");
				//autocomplete용 keyup event
				$("#schVal").on("keyup", function(e) {
					var target = $(this);
					_target = target;
					
					if (e.keyCode != 38 && e.keyCode != 40 && e.keyCode != 13) {	//상,하,엔터키 아닌경우만
						if($(this).val().length >= 5) {
							$.ajax({
								type:"post"
								,url:"/eins/ajaxEmpListForAutocomplete"
								,data: { schVal : $(this).val() }
								,dataType:"json"
								,success: function(data) {
									$("#ulAutoEmp li").remove();
									$(data.empList).each(function(i) {
										//0: ldap_id, 1: emp_name, 2: grade_name, 3: dept_name, 4: target Element index
										var newItem = '<li data-ldap_id="{0}" data-emp_name="{1}">{1}({0})<small> / {3}</small></li>';
										newItem = newItem.replace(/\{0\}/g, this.LDAP_ID);
										newItem = newItem.replace(/\{1\}/g, this.EMP_NAME);
										newItem = newItem.replace(/\{2\}/g, this.GRADE_NAME);
										newItem = newItem.replace(/\{3\}/g, this.DEPT_NAME);
										$("#ulAutoEmp").append(newItem);
									});
								}
								,error: function(responseJSON, status, err) {
									//alert(err);
								}
								,complete: function() {
									//autocomplete 보이기
									fnc_autocompleteShow();	
								}
							});
						}
					}
				});
				
				//autocomplete용 이벤트 중복 방지를 위해 off 선행
				$("#schVal").off("keydown");
				//autocomplete용 keydown event
				$("#schVal").on("keydown", function(e) {
					var target = $(this);
					if (e.keyCode == 38 || e.keyCode == 40 || e.keyCode == 13) {
						if($("#divAutoEmp").is(":visible")) {
							var item = $("#ulAutoEmp .active");
							var index = $("#ulAutoEmp li").index(item);
							if(e.keyCode == 13) {
								if(index > -1) {
									fnc_autoSelectEmployee(target, item);
								}
							} else {
								var move = e.keyCode == 38 ? -1 : 1;
								if(index > -1) {
									$(item).removeClass("active");
									$("#ulAutoEmp li").eq(index + move).addClass("active");
									var activeItem = $("#ulAutoEmp .active");
									if(activeItem.length > 0) {
										$("#divAutoEmp").scrollTop($(activeItem).position().top + $("#divAutoEmp").scrollTop() - ($(activeItem).height() * 3));
									}
								} else {
									$("#ulAutoEmp li").eq(0).addClass("active");
								}
							}
						} 
					}
				});
				
				//autocomplete용 이벤트 중복 방지를 위해 off 선행
				$("#schVal").off("blur");
				//autocomplete용 blur event
				$("#schVal").on("blur", function(e) {
					//선택완료 되지 않은경우 입력값 비우기
					var target = $(this);
					if($(target).data("selected") != "Y") {
						$(target).val("");
					}
					
					//클릭 이벤트 선행을 위해 간격을 두고 숨김 처리
					setTimeout(function() {
						fnc_autocompleteHide();
					}, 500);
				});
				
				// 숨김영역 클릭
				$("#divInfo").on("click", function(){
					var title = "▼"
					if($("#divInfoContent").css("display") == "none") {
						$("#divInfoContent").show();
						title = "▲"
					} else {
						$("#divInfoContent").hide();
					}
					$(this).text(title);
				});
				
				// 한글입력막기 스크립트
				$("#viewCnt").keyup(function(e) { 
					var v = $(this).val();
					$(this).val(v.replace(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣|a-z]/gi,''));
				});
				
				$(this).keydown(function (key) {
					var keyCode = key.keyCode;
					// 화면에 컨펌창이 떠있을때.. 엔터:확인버튼 자동클릭, ESC:취소버튼 자동클릭
					if($(".jconfirm").length > 0) {
						if(keyCode == 13) {
							if($("#attendId").val() != "") {
								$(".btn.btn-info").click();
							}
						} else if(keyCode == 27) {
							$(".btn.btn-default").click();
						}
					}
				});
				
				$("#rnd").change(function(e) { 
					rndChange();
				});
			});
			
			//차수 변경시
			function rndChange() {
				if($("#rnd").val() == "99") {
					$("#viewCnt").addClass("required");
					$(".rnd99Area").show();
				} else {
					$("#viewCnt").removeClass("required");
					$(".rnd99Area").hide();
				}
			}
			
			//autocomplete 보이기
			function fnc_autocompleteShow() {
				if($(_target).parent().find("#divAutoEmp").length == 0) {
					var autoHtml = "";
					autoHtml += '<div id="divAutoEmp" style="border:1px solid #ccc; background:#ffffff; position: absolute; overflow-y:scroll; min-height:150px; min-width:200px; z-index:100;">';
					autoHtml += '	<ul style="list-style:none; padding:10px;" id="ulAutoEmp"></ul>';
					autoHtml += '</div>';
					$(_target).parent().append(autoHtml);	
				}
			}
			
			//autocomplete 숨기기
			function fnc_autocompleteHide() {
				$("#divAutoEmp").remove();
			}
			
			//재직자 선택 완료
			function fnc_autoSelectEmployee(target, item) {
				var ldap_id = $(item).data("ldap_id");
				var emp_name = $(item).data("emp_name") + "(" +  ldap_id + ")";
				$(target).val(emp_name);
				
				//파라미터 셋팅
				$("#attendId").val(ldap_id);
				
				fnc_attendance();
			}
			
			//등록
			function fnc_attendance() {
				if($("#attendId").val() == "") {
					fnc_toastMsgForWarning("이름을 선택하세요.");
					return;
				}
				
				if($("#frm1").valid()){
					bConfirm($("#schVal").val() + "<br>" + "등록 하시겠습니까?").done(function(s) {
						if(s) {
							var dataArray = $("#frm1").serializeArray();
							
							$.ajax({
								type:"post"
								,url:"/eins/ajaxInsertEinsAttendance"
								,data: dataArray
								,dataType: "json"
								,success: function(data) {
									if(data.result == 1) {
										fnc_toastMsgForResult("등록 되었습니다.");
										
									} else if(data.result == -1) {
										alert(data.resultMsg);
										
									} else {
										fnc_toastMsgForWarning(data.resultMsg);
									}
									
									init();
								}
								,error: function(responseJSON, status, err) {
								}
							});
							
						} else {
							init();
						}
					});
				}
			}
			
			function init() {
				rndChange();
				$("#attendId").val("");
				$("#schVal").val("");
				$("#schVal").focus();
			}
		</script>
		<div id="content">
			<div class="container" style="z-index: 101;">
				<div class="alert alert-warning margin-bottom-10 margin-top-9">
					<span class="weight-600" id="divInfo" style="cursor: pointer;">▼</span>
					<div class="margin-top-3" id="divInfoContent" style="display: none;">
						<input type="text" class="form-control width-120 datepicker required" id="attendDay" name="attendDay" data-format="yyyy-mm-dd" data-lang="en" data-rtl="false" autocomplete="off" readonly="" data-msg="날짜를 선택하세요.">
						<select class="form-control required" id="rnd" name="rnd" data-msg="차수를 선택하세요."><option value="">차수 선택</option><option value="1" data-rfval1="070000">1회차</option><option value="2" data-rfval1="084600">2회차</option><option value="3" data-rfval1="091600">3회차</option><option value="99" data-rfval1="094600">주간 몰아보기</option></select>
						<input type="number" class="form-control width-40 rnd99Area" id="viewCnt" name="viewCnt" value="5" data-msg="몰아보기 횟수를 입력하세요." style="display: none;"><span class="rnd99Area" style="display: none;"> 회 몰아보기 (※ 몰아보기 회차시간에만 적용됩니다.)</span>
					</div>
				</div>
			</div>
			<div class="pass-dim pass-dim-center">
				<form id="frm1" name="frm1" method="post" onsubmit="return false;" novalidate="novalidate">
					<input type="hidden" id="attendId" name="attendId" value="">
				
					<div class="pass-dim-inner" style="width:560px;">
						<h4 class="bul-1 margin-top-0">에듀윌 인사이트 스파크 출결체크</h4>
						<p class="text-primary margin-top-0 margin-bottom-20">
							개인 <span style="font-weight:bold;">주민번호 앞자리(6자리)</span> 또는 <span style="font-weight:bold;">사번(EW 제외한 숫자 8자리)</span>을 입력하세요.
							<br>
							- 주민번호 앞자리가 동일한 임직원이 2명 이상일 경우에는, 본인 이름을 선택하세요.
							<br>- 사번은 사원증 우측 상단 또는 피플 &gt; 인사관리 &gt; 내 인사정보에서 확인 가능합니다.
							<br><br>
							개인 주민번호 앞자리(6자리) 또는 사번(숫자 8자리)을 입력하세요.
						</p>
						<input type="text" class="form-control js-dropdown width-300" id="schVal" name="schVal" placeholder="생년월일 혹은 사번" autocomplete="off">
					</div>
				</form>
			</div>
		</div>
		
		
	</section>
	<!-- // middle -->
</div>
<!-- // wrapper -->

</body>
</html>