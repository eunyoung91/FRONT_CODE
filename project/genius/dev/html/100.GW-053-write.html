<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<title>에듀윌 그룹웨어(Genius)</title>

<!-- favicon files -->
<link rel="Bookmark Icon" href="//img.eduwill.net/Img2/Common/favicon/favicon.ico" />
<link rel="icon" href="//img.eduwill.net/Img2/Common/favicon/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="//img.eduwill.net/Img2/Common/favicon/favicon.ico" type="image/x-icon" />

<!-- css files -->
<!-- layout css -->
<link rel="stylesheet" href="https://img.eduwill.net/resources/kpi/dev/plugins/bootstrap/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://img.eduwill.net/resources/kpi/dev/css/essentials.css" />
<link rel="stylesheet" href="css/genius.css" />


<!-- javascript files -->
<script type="text/javascript">var plugin_path = '//img.eduwill.net/resources/kpi/live/plugins/';</script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/jquery/jquery-2.2.3.min.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/jquery/jquery-ui-1.12.1.min.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/js/jquery.easyui.min.js" type="text/javascript" ></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/bootstrap.datepicker/js/bootstrap-datepicker.min.js"></script>
<script src="//img.eduwill.net/resources/kpi/live/js/ajaxUtil.js" type="text/javascript"></script>

<!-- validation -->
<script src="//img.eduwill.net/resources/kpi/live/plugins/form.validate/jquery.form.min.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/form.validate/jquery.validation.min.js" type="text/javascript"></script>

<script src="//img.eduwill.net/resources/kpi/live/js/custom.js?v=5a2d148c09b00" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/js/common.js?v=5ad59eb6c6f40" type="text/javascript"></script>

<!-- 토스트메시지 -->
<link href="//img.eduwill.net/resources/kpi/live/plugins/toastr/toastr.min.css" rel="stylesheet" type="text/css" />
<script src="//img.eduwill.net/resources/kpi/live/plugins/toastr/toastr.min.js" type="text/javascript"></script>

<!-- 컨펌모달 -->
<link rel="stylesheet" href="//img.eduwill.net/resources/kpi/live/plugins/jquery-confirm/jquery-confirm.min.css">
<script src="//img.eduwill.net/resources/kpi/live/plugins/jquery-confirm/jquery-confirm.min.js"></script>

<!-- print -->
<script type="text/javascript" src="//img.eduwill.net/resources/kpi/live/plugins/printThis/printThis.js"></script>

<!-- editable -->
<script type="text/javascript" src="//img.eduwill.net/resources/kpi/live/plugins/bootstrap-editable.min.js"></script>

<!-- Fullcalendar -->
<link rel="stylesheet" href="//img.eduwill.net/resources/kpi/live/plugins/fullcalendar/fullcalendar.min.css" />
<link rel="stylesheet" href="//img.eduwill.net/resources/kpi/live/plugins/fullcalendar/fullcalendar.print.css" media="print" />
<script src="//img.eduwill.net/resources/kpi/live/plugins/moment.min.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/fullcalendar/fullcalendar.min.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/fullcalendar/lang-all.js" type="text/javascript"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/fullcalendar/gcal.js" type="text/javascript"></script>

<!-- CKEditor -->
<script src="//img.eduwill.net/resources/kpi/live/plugins/ckeditor/ckeditor_4.10.0_full/ckeditor.js"></script>
<script src="//img.eduwill.net/resources/kpi/live/plugins/ckeditor/ckeditor_4.10.0_full/adapters/jquery.js"></script>

<script type="text/javascript">
	function pagePrint(){
		$('#pagePrint').printThis();
	}

	$(document).ready(function() {
		/** Bootstrap Tooltip **/ 
		$("[data-toggle=tooltip]").tooltip();
	})

</script>

</head>

<body class="body-sub body-genius">

<!-- wrapper -->
<div id="wrapper" class="clearfix">

	<!-- hd-wrap -->
    <section class="hd-wrap">
        <div class="hd-wrap-inner">
            <div class="logo">
                <a href="">지니어스</a>
            </div>
            <div class="gnb">
                <ul>
                    <li><a href="">전자결재</a></li>
                    <li><a href="">전사공지</a></li>
                    <li><a href="">업무요청</a></li>
                    <li><a href="">인사관리</a></li>
                    <li><a href="">지원관리</a></li>
                </ul>
            </div>
            <div class="comp-right">
                
                <div class="logout">
                    <button class="btn btn-g-link">로그아웃</button>
                </div>
                <div class="state">
                    <span onclick="$(this).next('.menu-tootip').fadeIn(100);"><i class="state-1"></i> 근무중</span>
                    <!--
                    <span><i class="state-2"></i> 자리비움</span>
                    <span><i class="state-3"></i> 로그오프</span>
                    -->
                    <div class="menu-tootip" style="display: none;" onclick="$(this).fadeOut(100);">
                        <div class="menu-tootip-inner">
                            <div class="link"><a href="#"><i class="state-1"></i> 근무중</a></div>
                            <div class="link"><a href="#"><i class="state-2"></i> 자리비움</a></div>
                            <div class="link"><a href="#"><i class="state-3"></i> 로그오프</a></div>
                        </div>
                    </div>
                </div> 
                <div class="organization">
                    <span><button class="btn btn-g-link btn-setting">관리자</button></span>
                    <span><button class="btn btn-g-link btn-person">조직도</button></span>
                </div>               
            </div>
        </div>
    </section>
    <div class="hd-wrap-expand" style="display: none;">
        <div class="hd-wrap-expand-inner">
            <div class="link">
                <a herf="">결재문서 작성</a>
                <a herf="">결재하기</a>
                <a herf="">수신함</a>
                <a herf="">매출/예산 계획 제출</a>
            </div>
            <div class="link">
                <a herf="">공지사항</a>
                <a herf="">에듀윌러 소식</a>
                <a herf="">에듀윌 스타</a>
                <a herf="">꿈의 직장</a>
            </div>
            <div class="link">
                <a herf="">마케팅</a>
                <a herf="">총무</a>
                <a herf="">IT</a>
                <a herf="">법무</a>
            </div>
            <div class="link">
                <a herf="">인사정보</a>
                <a herf="">평가</a>
                <a herf="">교육</a>
                <a herf="">자주 묻는 질문</a>
            </div>
            <div class="link">
                <a herf="">힐링큐브</a>
                <a herf="">E-스퀘어</a>
                <a herf="">차량배차</a>
                <a herf="">마음,쉼</a>
            </div>
        </div>
    </div>
    <!-- // hd-wrap -->

	<!-- aside -->
	<aside id="aside">
		<div class="aside-loaction">
			<strong>전사공지</strong>
			<button class="btn-collapse">접기</button>
		</div>
		<nav id="sideNav">
			<ul class="nav nav-list d1">
				<li class="d1 el_primary menu-open active">
					<a href="javascript:;" class="d1">
						<i class="main-icon fa fa-gears"></i>
						<span>공지사항</span>
					</a>
					<ul class="d2"><!-- 2depth -->
						<li class="d2 active">
							<span>업적/역량</span>
							<ul class="d3"><!-- 3depth -->
								<li class="d3 active">
									<a href="javascript:;" class="d3">전체공지
										<!-- <span class="label label-number">8</span> -->
									</a>
								</li>
								<li class="d3">
									<a href="javascript:;" class="d3">평가목표 관리</a>
								</li>
							</ul><!-- // 3depth -->
						</li>
					</ul><!-- // 2depth -->
				</li>
				<li class="d1 el_primary">
					<a href="javascript:;" class="d1">
						<i class="main-icon fa fa-balance-scale"></i>
						<span>에듀윌러 소식</span>
					</a>
					<ul class="d2"><!-- 2depth -->
						<li class="d2">
							<a href="javascript:;" class="d2">depth2</a>
						</li>
						<li class="d2">
							<a href="javascript:;" class="d2">depth2</a>
						</li>
					</ul>
				</li>
				<li class="d1 el_primary">
					<a href="javascript:;" class="d1">
						<i class="main-icon fa fa-pencil-square-o"></i>
						<span>에듀윌 스타</span>
					</a>
					<ul class="d2"><!-- 2depth -->
						<li class="d2">
							<a href="javascript:;" class="d2">depth2</a>
						</li>
						<li class="d2">
							<a href="javascript:;" class="d2">depth2</a>
						</li>
					</ul>
				</li>
				<li class="d1">
					<a href="javascript:;" class="d1">
						<i class="main-icon fa fa-table"></i>
						<span>꿈의직장</span></span>
					</a>
				</li>
			</ul>
		</nav>
	</aside>
	<div id="expand-wrap" style="display: none;">
		<button class="btn-expand">열기</button>
	</div>
	<!-- // aside -->

	<!-- middle -->	
	<section id="middle">

		<script type="text/javascript">
			
		
			// 첨부파일 담을 리스트
			var fileArray=[];
			// 첨부파일 이름 담을 리스트
			var fileNmArray=[];
			
			$(document).ready(function() {		
		
				//툴팁효과
				$("[data-toggle=tooltip]").tooltip();
				
				// 신청대상폼 추가		
				$('#addTrForm').on('click', function(){
					$('#tbody').append(trgetForm);
					
					$(document).find(".datepicker").datepicker({
						language: "kr"
					   ,autoclose: true
					});
					
				});
				
				// 삭제
				$(document).on('click', '#deleteTrForm', function(){
					$(this).closest('tr').remove();
				});
		
		
				// 첨부파일 영역 추가
				$('#addFileArea').on('click', function(){
					$(this).closest('.bg-white').append(fileForm);
					
				});
				
				
				
				
				// 삭제
				$(document).on('click', '#deleteFileArea', function(){
		
					var filename = $(this).closest('#divFile').find('#filename').val();
					
					if(filename != ''){
						
						// 파일배열에서 삭제
						var idx = fileNmArray.indexOf(filename);
						fileNmArray.splice(idx,1);
						fileArray.splice(idx,1);
						
						$(this).closest('#divFile').remove();
					}else{
						$(this).closest('#divFile').remove();
					}
		
				});
		
		
				// 파일찾기 이벤트
				$(document).on("change", "#insurFile",function(e){
					var ele = $(this).closest('#divFile');
					fn_checkFile(e, ele);
				});
		
		
				// 취득일 - 숫자만 입력
				$("#trgetDt").keyup(function(e) {
					   var v = $(this).val();
					$(this).val(v.replace(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣|a-z]/gi,''));
				   });		
				   
				
		
				// 목록버튼 이벤트
				$("#btnList").on("click", function(){
					location.href = '/insur/index';
				});
		
				
		
				// 저장버튼 이벤트
				$("#btnSave").on("click", function(){
					
					if(fn_isValidInput()){
		
						
						bConfirm("신청 하시겠습니까?").done(function(s) {
		
							if(s){									
								var frm1 = document.getElementById("frm1");
								var dataArray = new FormData(frm1);
		
								// file Input박스가 한개이기 때문에. 여러 파일을 담기 위해 배열에 담음.
								var fileSize = fileArray.length;
															
								if(fileSize > 0){
									for(var i = 0 ; i < fileSize ; i++){
										dataArray.append("insurfiles", fileArray[i]);
									}
								}
								
								$.ajax({
									type:"post"
									,url:"/insur/save"
									,data: dataArray
									,dataType: "json"
									,enctype : 'multipart/form-data'
									,processData : false
									,contentType : false
									,success: function(data) {
										if(data.result == 'OK') {							
											fnc_toastMsgForResult("신청 되었습니다.");
												
											setTimeout(function(){
												location.href = '/insur/index';
											}, 500);
											
											
										} else {
											fnc_toastMsgForWarning(data.result);
										}
									}
									,error: function(responseJSON, status, err) {
									}
								});
								
							}
							
						});
					}
					
				});
		
		
				
			});
		
			
		
		
			//폼 유효성검사
			function fn_isValidInput() {
		
				var a = true
		
				$('input[id=trgetRel]').each(function(){
					if($(this).val() == ''){
						$(this).focus()
						$(this).addClass('error');
						fnc_toastMsgForWarning("관계를 입력해 주세요");
						a=false;
						return false;
					}
					if(a != false) $(this).removeClass('error');
					
				});
				if(a == false) return false;
				
		
				$('input[id=trgetNm]').each(function(){
					if($(this).val() == ''){
						$(this).focus()
						$(this).addClass('error');
						fnc_toastMsgForWarning("이름을 입력해 주세요");
						a=false;
						return false;
					}
					if(a != false) $(this).removeClass('error');
					
				});
				if(a == false) return false;
				
		
				var date_pattern = /[0-9]{4}-[0-9]{2}-[0-9]{2}/;
				$('input[id=trgetDt]').each(function(){
					if($(this).val() == ''){
						$(this).focus()
						$(this).addClass('error');
						fnc_toastMsgForWarning("취득일을 선택해 주세요");
						a=false;
						return false;
					}
		
					if(date_pattern.test($(this).val()) == false){
						$(this).focus()
						$(this).addClass('error');
						fnc_toastMsgForWarning("날짜 형식을 확인해 주세요");
						a=false;
						return false;
					}
		
					if(a != false) $(this).removeClass('error');
					
				});
				if(a == false) return false;
				
		
				
				
				
				if($('#insurFile').val() == ''){
					fnc_toastMsgForWarning("첨부파일을 선택해 주세요");
					a=false;
					return false;
				}
		
				return a
			}
		
			
		
			// 파일 유효성 검증 및 설정
			function fn_checkFile(e, ele){
				var files = e.target.files
				var filesArray = Array.prototype.slice.call(files);
		
		
				filesArray.forEach(function(f){
					var type = f.type;
					var size = f.size;
					var name = f.name;
					var allowExt = [
						'jpg', 'jpeg', 'pdf', 'png', 'ppt','pptx','doc','docx'
						,'hwp', 'xls','xlsx', 'zip','txt','bmp','txt'
					];
		
					
					
					//동일파일명일 경우 저장안함
					$("input[id=filename]").each(function(){
						if(name == $(this).val()) return false;
					});
		
					
					var extTmp = name.split('.');
					if(extTmp == null || extTmp.length < 1){
						fnc_toastMsgForWarning("파일 형태가 잘못되었습니다.");
						return false;
					}
		
		
					//확장자 확인
					var ext = extTmp[extTmp.length - 1].toLowerCase();
					if(allowExt.indexOf(ext) == -1) {
						fnc_toastMsgForWarning("파일은 JPG, PNG, PDF, ppt, pptx, 한글, 워드, 엑셀, zip 형식만 가능합니다.");
						return false;
					}
		
					
					//파일 총 용량 제한(10MB)
					var allowSize = 10 * 1024 * 1024; // 바이트
					var totalSize = size;
					$("input[id=filesize]").each(function(){
						totalSize += Number($(this).val());
					});
		
		
					if(allowSize < totalSize) {
						fnc_toastMsgForWarning("파일 용량은 최대 10MB 입니다.");
						return false;
					}
		
					
					fileArray.push(f);
					fileNmArray.push(name);
					
					ele.find('#filesize').val(size);
					ele.find('#filename').val(name);
		
				});
				
			}
		
		
		
		
			
			
		</script>
		
		<div id="content" class="height-full padding-20"><!-- content -->
			<div class="container section-search-form section-search-form-bg">
				<div class="middle-location">
					<a href="/" class="home">홈</a>
					<a href="#">인사관리</a>
					<a href="#">인사서비스</a>
					<a href="#">건강보험피부양자 신청</a>
				</div>
			</div>
					
			<div class="container nopadding panel-light">
				
				<div class="panel-body">
				<form method="post" id="frm1" name="frm1">
				
					<h4 class="bul-1">건강보험피부양자 신청</h4>
					<div class="table-responsive table-basic"><!-- table-basic -->
						<table id="datatable" class="table table-col" cellpadding="0" cellspacing="0">
							<colgroup>
								<col width="10%">
								<col width="15%">
								<col width="10%">
								<col width="15%">
								<col width="7%">
							</colgroup>
							<thead>
								<tr>
									<th scope="col">관계</th>
									<th scope="col">이름</th>
									<th scope="col">취득일 <span class="margin-bottom-10" data-toggle="tooltip" title="" data-original-title="승인일로부터 4개월 전까지 소급신청 가능">
										<i class="fa fa-exclamation-circle"></i></span>
									</th>
									<th scope="col">비고</th>
									<th scope="col">관리</th>
								</tr>
							</thead>
							<tbody id="tbody">
								<tr>
									<td>
										<input type="text" class="form-control full" value="" id="trgetRel" name="trgetRel" maxlength="15" placeholder="ex) 아버지">
									</td>
									<td>
										<input type="text" class="form-control full" value="" id="trgetNm" name="trgetNm" maxlength="15">
									</td>
									<td>
										<input type="text" class="form-control full datepicker" id="trgetDt" name="trgetDt" maxlength="11" data-format="yyyy-mm-dd" data-lang="en" data-rtl="false" value="" autocomplete="off" placeholder="ex) 2020-03-08">
									</td>
									<td>
										<input type="text" class="form-control full" value="" id="trgetRmk" name="trgetRmk" maxlength="100">
									</td>
									<td class="text-center">
										<button type="button" class="btn btn-primary btn-amount width-50" id="addTrForm">+</button>
									</td>
								</tr>
								
							
				<tr>
					<td>
						<input type="text" class="form-control full" value="" id="trgetRel" name="trgetRel" maxlength="15">
					</td>
					<td>
						<input type="text" class="form-control full" value="" id="trgetNm" name="trgetNm" maxlength="15">
					</td>
					<td>
						<input type="text" class="form-control full datepicker" id="trgetDt" name="trgetDt" maxlength="11" data-format="yyyy-mm-dd" data-lang="en" data-rtl="false" value="" autocomplete="off">
					</td>
					<td>
						<input type="text" class="form-control full" value="" id="trgetRmk" name="trgetRmk" maxlength="100">
					</td>
					<td class="text-center">
						<button type="button" class="btn btn-danger btn-amount width-50" id="deleteTrForm">-</button>
					</td>
				</tr>
			</tbody>
						</table>
					</div>
					
					
		
					<h4 class="bul-1">건강보험피부양자 신청 첨부파일</h4>
					<div class="table-responsive table-basic"><!-- table-basic -->
						<table class="table table-bordered">
							<caption>기본정보</caption>
							<colgroup>
								<col width="15%">
								<col width="85%">
							</colgroup>
							<tbody> 
								<tr>
									<th>
										첨부파일 <span class="text-red">*</span> <span class="margin-bottom-10" data-toggle="tooltip" title="" data-original-title="가족관계증명서(본인과의 관계 및 주민번호 전부표시), 형제.자매일 경우 혼인관계증명서(혼인이력 없음 표시)">
										<i class="fa fa-exclamation-circle"></i></span> 
									</th>
									<td class="name" colspan="3">
										<div class="margin-bottom-0 padding-20 border border-silver bg-white">
											<!-- 파일영역 -->
											<div id="divFile" class="section-leave" style="width: 100%;">
												<div class="fancy-file-upload file1 file1-input">
													<i class="fa fa-upload"></i>
													<input type="file" class="form-control" id="insurFile" name="insurFile">
													<input type="text" class="form-control upload-name" id="filename" placeholder="no file selected" readonly="">
													<input type="hidden" id="filesize" name="filesize" value="">
													
													<span class="button width-120 text-center">파일찾기</span>
													<button type="button" class="btn btn-primary btn-amount" id="addFileArea">+</button>
												</div>
											</div>
											<!--  -->
										
				<div id="divFile" class="section-leave" style="width: 100%;">
					<div class="fancy-file-upload file1 file1-input">
						<i class="fa fa-upload"></i>
						<input type="file" class="form-control" id="insurFile" name="insurFile">
						<input type="text" class="form-control upload-name" id="filename" placeholder="no file selected" readonly="">
						<input type="hidden" id="filesize" value="">
							
						<span class="button width-120 text-center">파일찾기</span>
						<button type="button" class="btn btn-danger btn-amount" id="deleteFileArea">-</button>
					</div>
				</div>
			</div>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<span class="text-red">* 약 1주일 후 목록에서 결과 확인 가능합니다.</span>
					
					
					<div class="text-center margin-top-20">
						<button type="button" class="btn btn-lg width-120 btn-teal" id="btnList">목록</button>
						<button type="button" class="btn btn-lg width-120 btn-primary margin-left-10" id="btnSave">저장</button>
					</div>
				</form>
				</div>
			</div><!-- // container -->
			
		
		</div><!-- // content -->
		
		
		
		<script type="text/javascript">
		
			var trgetForm =`
				<tr>
					<td>
						<input type="text" class="form-control full" value="" id="trgetRel" name="trgetRel" maxlength="15" >
					</td>
					<td>
						<input type="text" class="form-control full" value="" id="trgetNm" name="trgetNm" maxlength="15">
					</td>
					<td>
						<input type="text" class="form-control full datepicker" id="trgetDt" name="trgetDt" maxlength="11" data-format="yyyy-mm-dd" data-lang="en" data-RTL="false" value="" autocomplete="off"/>
					</td>
					<td>
						<input type="text" class="form-control full" value="" id="trgetRmk" name="trgetRmk" maxlength="100">
					</td>
					<td class="text-center">
						<button type="button" class="btn btn-danger btn-amount width-50" id="deleteTrForm">-</button>
					</td>
				</tr>
			`;
			
			
			var fileForm =`
				<div id="divFile" class="section-leave" style="width: 100%;" >
					<div class="fancy-file-upload file1 file1-input">
						<i class="fa fa-upload"></i>
						<input type="file" class="form-control" id="insurFile" name="insurFile">
						<input type="text" class="form-control upload-name" id="filename" placeholder="no file selected" readonly="" />
						<input type="hidden" id="filesize" value="">
							
						<span class="button width-120 text-center">파일찾기</span>
						<button type="button" class="btn btn-danger btn-amount" id="deleteFileArea">-</button>
					</div>
				</div>
			`;
			
		</script>
		
		
		
		
		
		
			
		
	</section>
	<!-- // middle -->
</div>
<!-- // wrapper -->

</body>
</html>